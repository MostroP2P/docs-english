<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How does Mostro work? - Mostro-FAQ</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Quick Start ðŸš€</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">1.</strong> Frequently Asked Questions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="what-is-mostro.html"><strong aria-hidden="true">1.1.</strong> What is Mostro?</a></li><li class="chapter-item expanded "><a href="need-it.html"><strong aria-hidden="true">1.2.</strong> What do I need to use Mostro?</a></li><li class="chapter-item expanded "><a href="no-kyc.html"><strong aria-hidden="true">1.3.</strong> Do I need to register or do KYC?</a></li><li class="chapter-item expanded "><a href="how-it-works.html" class="active"><strong aria-hidden="true">1.4.</strong> How does Mostro work?</a></li><li class="chapter-item expanded "><a href="currencies-payment-methods.html"><strong aria-hidden="true">1.5.</strong> Accepted Currencies and Payment Methods</a></li><li class="chapter-item expanded "><a href="fees-and-limits.html"><strong aria-hidden="true">1.6.</strong> Exchange Fees and Limits</a></li><li class="chapter-item expanded "><a href="cancelling-an-order.html"><strong aria-hidden="true">1.7.</strong> Can I cancel an order?</a></li><li class="chapter-item expanded "><a href="hold-invoice.html"><strong aria-hidden="true">1.8.</strong> Hold Invoices: Security of Exchanges on Mostro</a></li><li class="chapter-item expanded "><a href="times.html"><strong aria-hidden="true">1.9.</strong> Exchange Times</a></li><li class="chapter-item expanded "><a href="reputation.html"><strong aria-hidden="true">1.10.</strong> Reputation System</a></li><li class="chapter-item expanded "><a href="disputes.html"><strong aria-hidden="true">1.11.</strong> Dispute Management</a></li><li class="chapter-item expanded "><a href="privacy.html"><strong aria-hidden="true">1.12.</strong> Privacy in Mostro</a></li><li class="chapter-item expanded "><a href="support-and-contacts.html"><strong aria-hidden="true">1.13.</strong> Support and Contact</a></li><li class="chapter-item expanded "><a href="contribute.html"><strong aria-hidden="true">1.14.</strong> How to Contribute</a></li></ol></li><li class="chapter-item expanded "><a href="clients.html"><strong aria-hidden="true">2.</strong> Clients. How to use Mostro</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mostro-mobile.html"><strong aria-hidden="true">2.1.</strong> Mostro mobile</a></li><li class="chapter-item expanded "><a href="mostro-cli.html"><strong aria-hidden="true">2.2.</strong> Mostro-cli</a></li><li class="chapter-item expanded "><a href="mostrix.html"><strong aria-hidden="true">2.3.</strong> MostriX</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mostro-FAQ</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MostroP2P/docs-english" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/MostroP2P/docs-english/edit/main/src/how-it-works.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="how-does-mostro-work"><a class="header" href="#how-does-mostro-work">How does Mostro work?</a></h1>
<p>To understand how Mostro works, it is important to know its components:</p>
<ul>
<li>
<p><a href="https://github.com/MostroP2P/mostro">Mostro daemon (Mostrod)</a>: Manages communication between users and the Lightning Network (LN) node. It publishes Nostr events, executes actions sent by users, and guides them through the exchange process.</p>
</li>
<li>
<p>Lightning Network node associated with the Mostrod instance: Creates and manages the <a href="./hold-invoice.html">hold invoices</a> that sellers must pay and makes payments for the invoices provided by buyers.</p>
</li>
<li>
<p><a href="./clients.html">Mostro clients</a>: These are the applications that users interact with directly. They provide the communication interface between Mostrod and the users. The clients send Mostrod the actions performed by users, such as creating an order, opening a dispute, releasing sats, among others. They are also responsible for generating and handling users' private keys.</p>
</li>
</ul>
<p>The following diagram summarizes how Mostrod, the seller (via a Mostro client), and the LN node interact:<br />
<img src="./assets/images/order-flow.png" alt="order-flow" /></p>
<h2 id="bitcoin-sale-flow-on-mostro"><a class="header" href="#bitcoin-sale-flow-on-mostro">Bitcoin Sale Flow on Mostro</a></h2>
<ul>
<li><strong>Seller:</strong> Alice</li>
<li><strong>Buyer:</strong> Bob</li>
</ul>
<ol>
<li>
<p><strong>Order creation:</strong><br />
Alice accesses a <a href="./clients.html">Mostro client</a> and decides to post an order to sell 5000 sats for 3 USD, to receive payment on her XYZ card. The interface for creating the order will depend on the <a href="./clients.html">client</a> she uses. The order is posted in an order book that can be accessed from any Mostro client. If another user does not take the order within <a href="times.html">24 hours</a>, it will be automatically deleted.</p>
</li>
<li>
<p><strong>Order taken by the buyer:</strong><br />
Bob, interested in buying sats, accesses a <a href="./clients.html">Mostro client</a> (not necessarily the same one Alice used). He finds the offer of 5000 sats for 3 USD and decides to take it. He is then asked to provide an invoice for 5000 sats within <a href="times.html">15 minutes</a>. Bob generates the invoice in his LN wallet and sends it to Mostro, who instructs him to wait <a href="times.html">15 minutes</a> for his counterparty to respond.</p>
</li>
<li>
<p><strong>Payment and communication between parties:</strong><br />
Alice receives a message from Mostro notifying her that someone has taken her offer and that she must pay a <a href="./hold-invoice.html">hold invoice</a> for 5000 sats within <a href="times.html">15 minutes</a>. If she does not make the payment, the order will be canceled. Once Alice pays the invoice, Mostro reveals Bobâ€™s public key to Alice and vice versa, allowing them to start a private chat. At this point, Alice must provide Bob with the number of her XYZ card to receive the fiat payment. When Bob sends her the 3 USD, he presses the <em>fiat sent</em> button in his Mostro client. Alice receives a notification to verify receipt of the fiat and then release the sats to Bob.</p>
</li>
<li>
<p><strong>Sats release:</strong><br />
When Alice confirms she received the 3 USD, she presses the <em>release</em> button in her Mostro client. Then Mostro will collect the 5000 sats from Alice's wallet and pay Bob's invoice. Finally, Mostro will ask both parties to rate their counterparty.</p>
</li>
</ol>
<p>When Mostro connects both users, the time they have to complete the exchange is limited by the duration of the <a href="./hold-invoice.html">hold invoice</a> provided by the Mostro instance they are using. Users must respect this time frame; for more information, see <a href="times.html">here</a>.</p>
<p>If during the process, Alice and Bob decide not to proceed with the exchange, they can <a href="./cancelling-an-order.html">cancel</a> the order cooperatively. If either party attempts to cancel arbitrarily or defraud the other, the other party can open a <a href="./disputes.html">dispute</a>.</p>
<blockquote>
<p><strong>Note:</strong> In this example, it is assumed that Mostroâ€™s fees are 0. For more information on fees, see <a href="./fees-and-limits.html">Exchange Fees and Limits</a>.</p>
</blockquote>
<h3 id="technical-explanation"><a class="header" href="#technical-explanation">Technical Explanation</a></h3>
<ol>
<li>
<p><strong>Alice creates the order:</strong><br />
When Alice creates the sale offer, her Mostro client should automatically generate a new Nostr private key that Alice will use only for that order (a new private key should always be generated for each order to protect usersâ€™ <a href="./privacy.html">privacy</a>). Using that key, Alice sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message to Mostrod with the order details. Then, Mostrod publishes an <a href="https://github.com/nostr-protocol/nips/blob/master/01.md#kinds">addressable event</a> of type 38383, with the order details and its status: <code>pending</code>. Mostro clients monitor these events and display those orders with <code>pending</code> status in their order books.</p>
</li>
<li>
<p><strong>Bob takes the order:</strong><br />
When Bob takes the order, his Mostro client automatically generates a new Nostr private key for this order, then sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message to Mostrod indicating that he has taken that offer. Mostrod publishes a new event 38383 for that order, this time with the status <code>waiting-buyer-invoice</code>, which removes the order from all clients' order books as it is no longer <code>pending</code>. Mostrod sends Bob a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message requesting an invoice for 5000 sats. Bob sends the invoice to Mostrod in a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message, and then Mostrod publishes an event 38383 for that order, this time with the status <code>waiting-payment</code>.</p>
</li>
<li>
<p><strong>Alice pays the hold invoice:</strong><br />
Mostrod sends Alice a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message with the <a href="./hold-invoice.html">hold invoice</a> generated by the associated LN node. If Alice pays within the 15 minutes, Mostro sends her a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message revealing Bob's pubkey, and another message to Bob revealing Alice's pubkey. Additionally, it updates the event 38383 for this order with the status <code>active</code>. Now, Alice and Bob can communicate directly through encrypted messages using the <a href="https://github.com/nostr-protocol/nips/blob/master/44.md">NIP-44</a> algorithm, and Mostrod does not receive any of those messages. When Bob makes the fiat payment and presses <em>fiat sent</em> in his client, he sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message with the <code>fiat-sent</code> action to Mostrod, who in turn sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message to Alice with that same action, and her client displays a <em>release</em> button to release the sats if she has received the payment. Mostrod also publishes an event 38383 for that order with the status <code>fiat-sent</code>.</p>
</li>
<li>
<p><strong>Alice releases the sats:</strong><br />
When Alice presses the <em>release</em> button in her client, she sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message to Mostrod indicating that the sats should be released to Bob. Then, the LN node associated with that instance of Mostrod settles the payment of the <a href="./hold-invoice.html">hold invoice</a> and pays the invoice provided by Bob. At the end of the process, Mostrod publishes an event 38383 for that order with the status <code>success</code> and sends a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message to Alice and Bob, requesting that they rate their counterparty, who send back their rating through a <a href="https://github.com/nostr-protocol/nips/blob/master/59.md">NIP-59</a> message.</p>
</li>
</ol>
<p>For more details on the communication between Mostrod and its clients, you can read <a href="https://mostro.network/protocol/">here</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="no-kyc.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="currencies-payment-methods.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="no-kyc.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="currencies-payment-methods.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
